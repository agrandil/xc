# Nama workflow yang akan tampil di tab Actions
name: Auto Commit 5 Files (Signed)

# Pemicu (trigger) untuk menjalankan workflow ini
on:
  schedule:
    # Berjalan setiap 5 menit menggunakan syntax cron
    - cron: '*/5 * * * *'
  
  # Baris ini memungkinkan Anda menjalankan workflow secara manual dari tab Actions
  workflow_dispatch:

# Daftar pekerjaan (jobs) yang akan dijalankan
jobs:
  auto_commit_job:
    # Menentukan bahwa job ini berjalan di mesin virtual Ubuntu versi terbaru
    runs-on: ubuntu-latest

    # Langkah-langkah yang akan dieksekusi secara berurutan
    steps:
      # Langkah 1: Melakukan "checkout" atau mengunduh kode dari repositori Anda
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Menggunakan token khusus agar workflow ini punya izin untuk melakukan 'push'
          token: ${{ secrets.GITHUB_TOKEN }}

      # Langkah 2: Impor Kunci GPG dari Secrets
      - name: Import GPG key
        uses: crazy-max/ghaction-import-gpg@v6
        with:
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.GPG_PASSPHRASE }}

      # Langkah 3: Mengatur identitas Git agar sesuai dengan akun Anda dan mengaktifkan GPG signing
      - name: Configure Git
        run: |
          git config --global user.name 'agrandil'
          # **PERBAIKAN:** Menggunakan email yang sama dengan yang ada di kunci GPG
          git config --global user.email 'qodratscr@gmail.com'
          git config --global commit.gpgsign true

      # Langkah 4: Membuat 5 commit terpisah dan melakukan push
      - name: "Create 5 Commits and Push"
        run: |
          # Selalu sinkronkan dengan server terlebih dahulu untuk menghindari konflik
          git pull

          # --- Menyiapkan data acak ---
          NEGARA_LIST=("Indonesia" "Malaysia" "Jepang" "Jerman" "Brazil" "Mesir" "Australia" "Kanada")
          BUAH_LIST=("Apel" "Mangga" "Jeruk" "Pisang" "Anggur" "Durian" "Rambutan")
          IKAN_LIST=("Tuna" "Salmon" "Lele" "Gurame" "Patin" "Tongkol" "Kakap")
          HARI_LIST=("Senin" "Selasa" "Rabu" "Kamis" "Jumat" "Sabtu" "Minggu")

          # --- Commit 1: negara.txt ---
          NEGARA_ACAK=${NEGARA_LIST[$RANDOM % ${#NEGARA_LIST[@]}]}
          echo "Negara acak yang terpilih: $NEGARA_ACAK" > negara.txt
          git add negara.txt
          git commit -m "feat: Perbarui negara.txt dengan negara acak ($NEGARA_ACAK)"

          # --- Commit 2: buah.txt ---
          BUAH_ACAK=${BUAH_LIST[$RANDOM % ${#BUAH_LIST[@]}]}
          echo "Buah acak yang terpilih: $BUAH_ACAK" > buah.txt
          git add buah.txt
          git commit -m "feat: Perbarui buah.txt dengan buah acak ($BUAH_ACAK)"

          # --- Commit 3: ikan.txt ---
          IKAN_ACAK=${IKAN_LIST[$RANDOM % ${#IKAN_LIST[@]}]}
          echo "Ikan acak yang terpilih: $IKAN_ACAK" > ikan.txt
          git add ikan.txt
          git commit -m "feat: Perbarui ikan.txt dengan ikan acak ($IKAN_ACAK)"

          # --- Commit 4: hari.txt ---
          HARI_ACAK=${HARI_LIST[$RANDOM % ${#HARI_LIST[@]}]}
          echo "Hari acak yang terpilih: $HARI_ACAK" > hari.txt
          git add hari.txt
          git commit -m "feat: Perbarui hari.txt dengan hari acak ($HARI_ACAK)"

          # --- Commit 5: log.txt ---
          HASIL=$((100 / 5 * 1000))
          echo "Perhitungan otomatis pada $(date): 100 / 5 * 1000 = $HASIL" >> log.txt
          git add log.txt
          git commit -m "docs: Perbarui log.txt dengan hasil perhitungan [ci skip]"

          # --- Push semua 5 commit sekaligus ---
          git push
